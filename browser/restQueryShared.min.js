(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.restQueryShared=e()}})(function(){var e,t,r;return function n(e,t,r){function i(s,o){if(!t[s]){if(!e[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var h=t[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return i(r?r:t)},h,h.exports,n,e,t,r)}return t[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,r){"use strict";t.exports={path:e("./path.js")}},{"./path.js":3}],2:[function(e,t,r){"use strict";var n={lowerCaseArray:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],upperCaseArray:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],digitArray:["0","1","2","3","4","5","6","7","8","9"],lowerCaseAndDigitArray:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],collectionRegExp:"^[A-Z][a-zA-Z0-9]*$",methodRegExp:"^[A-Z][A-Z0-9-]*$",propertyRegExp:"^(.[a-zA-Z0-9_-]+)+$",linkPropertyRegExp:"^~[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)*$",multiLinkPropertyRegExp:"^~~[a-zA-Z0-9_-]+$",idRegExp:"^[0-9a-f]{24}$",rangeRegExp:"^([0-9]+)(?:-([0-9]+))?$",slugIdRegExp:"^[a-z0-9-]{1,72}$",asciiMapCommon:{"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","ẞ":"ss","œ":"oe","Œ":"OE","“":'"',"”":'"',"‘":"'","’":"'","…":"..."},asciiMapWorldAlpha:{"α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","ş":"s","Ş":"S","ı":"i","İ":"I","ğ":"g","Ğ":"G","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ś":"S","Ź":"Z","Ż":"Z","ā":"a","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ū":"u","Ā":"A","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Ū":"u"},asciiMapSymbolsEn:{"€":" euro","₢":" cruzeiro","₣":" french franc","£":" pound","₤":" lira","₥":" mill","₦":" naira","₧":" peseta","₨":" rupee","₩":" won","₪":" new shequel","₫":" dong","₭":" kip","₮":" tugrik","₯":" drachma","₰":" penny","₱":" peso","₲":" guarani","₳":" austral","₴":" hryvnia","₵":" cedi","¢":" cent","¥":" yen","元":" yuan","円":" yen","﷼":" rial","₠":" ecu","¤":" currency","฿":" baht","\\$":" dollar","©":" (c)","∑":" sum","®":" (r)","†":" +","∂":" d","ƒ":" f","™":" tm","℠":" sm","˚":" o","º":" o","ª":" a","•":" *","∆":" delta","∞":" infinity","♥":" love","&":" and","\\|":" or","<":" less",">":" greater"},asciiMapSymbolsFr:{"€":" euro","₢":" cruzeiro","₣":" franc","£":" livre","₤":" lire","₥":" mill","₦":" naira","₧":" peseta","₨":" rupee","₩":" won","₪":" new shequel","₫":" dong","₭":" kip","₮":" tugrik","₯":" drachma","₰":" penny","₱":" peso","₲":" guarani","₳":" austral","₴":" hryvnia","₵":" cedi","¢":" cent","¥":" yen","元":" yuan","円":" yen","﷼":" rial","₠":" ecu","¤":" monnaie","฿":" baht","\\$":" dollar","©":" (c)","∑":" sum","®":" (r)","†":" +","∂":" d","ƒ":" f","™":" tm","℠":" sm","˚":" o","º":" o","ª":" a","•":" *","∆":" delta","∞":" infini","♥":" aime","&":" et","\\|":" ou","<":" moins",">":" plus"}};t.exports=n},{}],3:[function(e,t,r){"use strict";var n=e("./charmap.js");var i=e("string-kit/lib/camel.js");var a=e("tree-kit/lib/path.js");var s=e("url");var o={};t.exports=o;function u(e){return e.value}function f(){return this.value}function h(){return this.match.toString()}function l(){if(!arguments.length){return"/"+this.map(u).join("/")}else{return"/"+Array.prototype.slice.apply(this,arguments).map(u).join("/")}}function c(){return d(Array.prototype.slice.apply(this,arguments))}function p(){return this[this.length-1]}function d(e){e=e||[];Object.defineProperties(e,{toString:{value:l},slice:{value:c},last:{get:p}});return e}function y(e){e=e||{};Object.defineProperties(e,{primaryPath:{get:function(){if(this.subPath){return this.subPath.before}else{return this.full}}}});return e}o.parse=function w(e,t){var r,n,i,a,s,u,f;if(Array.isArray(e)){return e}else if(typeof e!=="string"){throw new Error("[restQuery] .parse() 'path' should be a string")}s=d();e=e.replace(/\/+/,"/");a=e.split("/");try{for(r=0,i=0,n=a.length;r<n;r++){if(a[r]===""){continue}u=o.parseNode(a[r],t);if(i&&(u.type==="property"||u.type==="linkProperty")&&s[i-1].type==="property"){s[i-1].identifier+="."+u.identifier;s[i-1].type=u.type}else{s[i]=u;i++}}}catch(h){f=new Error("Bad URL: '"+a[r]+"' does not match any node type");f.type="badRequest";throw f}return s};o.parseNode=function A(e,t){var r,a;if(e.length<1){throw new Error("[restQuery] parseNode() : argument #0 length should be >= 1")}if(e.length>72){throw new Error("[restQuery] parseNode() : argument #0 length should be <= 72")}var s={value:e,isDocument:false,isCollection:false};Object.defineProperties(s,{toString:{value:f}});if(t){if(e[0]==="{"&&e[e.length-1]==="}"){a=e.slice(1,-1).split(":");if(a[1]){s.matchName=a[1]}e=a[0];if(e[0]==="$"){s.type="context";s.contextPath=e=e.slice(1);return s}switch(e){case"*":s.type="wildcard";s.wildcard="any";break;case"...":s.type="wildcard";s.wildcard="anySubPath";break;case"id":s.type="wildcard";s.wildcard="anyId";s.isDocument=true;break;case"slugId":s.type="wildcard";s.wildcard="anySlugId";s.isDocument=true;break;case"document":s.type="wildcard";s.wildcard="anyDocument";s.isDocument=true;break;case"collection":s.type="wildcard";s.wildcard="anyCollection";s.isCollection=true;break;default:throw new Error("[restQuery] parseNode() -- bad node special type: "+e)}return s}a=e.split(":");if(a[1]){s.matchName=a[1]}e=a[0]}if(n.upperCaseArray.indexOf(e[0])!==-1){if(e.length===1){s.type="collection";s.identifier=e[0].toLowerCase()+e.slice(1);s.isCollection=true;return s}if(n.lowerCaseArray.indexOf(e[1])!==-1){if(e.match(n.collectionRegExp)){s.type="collection";s.identifier=e[0].toLowerCase()+e.slice(1);s.isCollection=true;return s}throw new Error("[restQuery] parseNode() : argument #0 start with an uppercase and then a lowercase letter but mismatch a collection type")}if(e.match(n.methodRegExp)){s.type="method";s.identifier=i.toCamelCase(e);return s}if(e.match(n.collectionRegExp)){s.type="collection";s.identifier=e[0].toLowerCase()+e.slice(1);s.isCollection=true;return s}throw new Error("[restQuery] parseNode() : argument #0 start with an uppercase but mismatch collection or method type")}if(e.length===24&&e.match(n.idRegExp)){s.type="id";s.identifier=e;s.isDocument=true;return s}if(e[0]==="."){if(!e.match(n.propertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}s.type="property";s.identifier=e.slice(1);s.isDocument=true;return s}if(e[0]==="~"){if(e[1]==="~"){if(!e.match(n.multiLinkPropertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}s.type="multiLinkProperty";s.identifier=e.slice(2);s.isCollection=true;return s}else{if(!e.match(n.linkPropertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}s.type="linkProperty";s.identifier=e.slice(1);s.isDocument=true;return s}}if(n.digitArray.indexOf(e[0])!==-1&&(r=e.match(n.rangeRegExp))){if(r[2]){s.type="range";s.min=parseInt(r[1],10);s.max=parseInt(r[2],10);s.isCollection=true;return s}s.type="offset";s.identifier=parseInt(e,10);s.isDocument=true;return s}if(n.lowerCaseAndDigitArray.indexOf(e[0])!==-1&&e.match(n.slugIdRegExp)){s.type="slugId";s.identifier=e;s.isDocument=true;return s}throw new Error("[restQuery] parseNode() : argument #0 does not validate")};function m(e){var t,r={};for(t in e){r[t]=e[t]}Object.defineProperties(r,{toString:{value:f}});return r}function g(e,t,r){if(!t[r]){t[r]=1}else if(t[r]===1){e[r+"1"]=e[r];delete e[r];t[r]=2;r+="2"}else{r+=++t[r]}return r}function v(e,t,r,n){n=g(e,r,n);e[n]=t;return t}function b(e,t,r,n,i,a){a=g(e,i,a);var s=Object.create(Object.prototype,{toString:{value:h}});s.match=t.slice(r,n+1);s.before=t.slice(0,r);s.after=t.slice(n+1);s.upto=t.slice(0,n+1);s.onward=t.slice(r);e[a]=s;return s}o.match=function x(e,t,r){try{if(!Array.isArray(e)){e=o.parse(e,true)}if(!Array.isArray(t)){t=o.parse(t)}}catch(n){return false}var i,s,u,f=null,h,l=0,c,p=null,g=y(),w=d(),A={};g.full=t;if(e.length===0){return t.length===0?g:false}if(r){h=d();for(i=0,s=e.length;i<s;i++){if(e[i].contextPath){h=h.concat(o.parse(a.get(r,e[i].contextPath)))}else{h.push(e[i])}}e=h}for(i=0,s=e.length;i<s;i++){if(e[i].contextPath){throw new Error("[restQuery] .match() this pattern needs a context.")}if(e[i].wildcard==="anySubPath"){l++}}for(i=0,s=t.length;i<s;i++){w[i]=m(t[i])}if(l){if(l>1){console.log("Warning: multiple 'anySubPath' wildcards in the same pattern are not supported ATM");return false}c=t.length-e.length+1;if(c<0){return false}}else if(t.length!==e.length){return false}for(i=0,u=0,s=e.length;i<s;i++,u++){p=null;switch(e[i].wildcard){case"any":f=null;b(g,w,u,u,A,e[i].matchName||"wild");break;case"anySubPath":f=null;b(g,w,u,u+c-1,A,e[i].matchName||"subPath");u+=c-1;break;case"anyId":if(t[u].type!=="id"){return false}p=b(g,w,u,u,A,e[i].matchName||"wildId");break;case"anySlugId":if(t[u].type!=="slugId"){return false}p=b(g,w,u,u,A,e[i].matchName||"wildSlugId");break;case"anyDocument":if(t[u].type!=="id"&&t[u].type!=="slugId"){return false}p=b(g,w,u,u,A,e[i].matchName||"wildDocument");break;case"anyCollection":if(t[u].type!=="collection"){return false}f=e[i].matchName||"wildCollection";p=b(g,w,u,u,A,f);break;default:if(e[i].type!==t[u].type||e[i].identifier!==t[u].identifier){return false}if(e[i].isCollection){f=e[i].matchName||e[i].identifier;b(g,w,u,u,A,f)}}if(e[i].isDocument&&f&&t[u]){if(p){v(g,p,A,f+"Document")}else{b(g,w,u,u,A,f+"Document")}}if(!e[i].isCollection){f=null}}return g};o.fullPathParse=function j(e,t){if(e&&typeof e==="object"){return e}var r,n={};r=e.match(/^(\/[^#?]*)(?:\?([^#?]+))?(?:#([^#?]+))?$/);if(!r){throw new Error("[restQuery] .fullPathParse() 'fullPath' should be a valid path")}n.path=o.parse(r[1],t);if(r[2]!==undefined){n.query=r[2]}if(r[3]!==undefined){n.fragment=r[3]}return n};o.fullPathMatch=function C(e,t){var r;try{if(!e||typeof e!=="object"){e=o.fullPathParse(e,true)}if(!t||t!=="object"){t=o.fullPathParse(t)}}catch(n){return false}if(typeof e.fragment==="string"&&e.fragment!==(t.fragment||"")){return false}r=o.match(e.path,t.path);if(!r){return false}if(t.fragment){r.fragment=t.fragment}return r}},{"./charmap.js":2,"string-kit/lib/camel.js":10,"tree-kit/lib/path.js":11,url:8}],4:[function(t,r,n){(function(t){(function(i){var a=typeof n=="object"&&n&&!n.nodeType&&n;var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof t=="object"&&t;if(o.global===o||o.window===o||o.self===o){i=o}var u,f=2147483647,h=36,l=1,c=26,p=38,d=700,y=72,m=128,g="-",v=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,j=Math.floor,C=String.fromCharCode,O;function E(e){throw new RangeError(A[e])}function P(e,t){var r=e.length;var n=[];while(r--){n[r]=t(e[r])}return n}function k(e,t){var r=e.split("@");var n="";if(r.length>1){n=r[0]+"@";e=r[1]}e=e.replace(w,".");var i=e.split(".");var a=P(i,t).join(".");return n+a}function I(e){var t=[],r=0,n=e.length,i,a;while(r<n){i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){a=e.charCodeAt(r++);if((a&64512)==56320){t.push(((i&1023)<<10)+(a&1023)+65536)}else{t.push(i);r--}}else{t.push(i)}}return t}function N(e){return P(e,function(e){var t="";if(e>65535){e-=65536;t+=C(e>>>10&1023|55296);e=56320|e&1023}t+=C(e);return t}).join("")}function R(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return h}function S(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function q(e,t,r){var n=0;e=r?j(e/d):e>>1;e+=j(e/t);for(;e>x*c>>1;n+=h){e=j(e/x)}return j(n+(x+1)*e/(e+p))}function U(e){var t=[],r=e.length,n,i=0,a=m,s=y,o,u,p,d,v,b,w,A,x;o=e.lastIndexOf(g);if(o<0){o=0}for(u=0;u<o;++u){if(e.charCodeAt(u)>=128){E("not-basic")}t.push(e.charCodeAt(u))}for(p=o>0?o+1:0;p<r;){for(d=i,v=1,b=h;;b+=h){if(p>=r){E("invalid-input")}w=R(e.charCodeAt(p++));if(w>=h||w>j((f-i)/v)){E("overflow")}i+=w*v;A=b<=s?l:b>=s+c?c:b-s;if(w<A){break}x=h-A;if(v>j(f/x)){E("overflow")}v*=x}n=t.length+1;s=q(i-d,n,d==0);if(j(i/n)>f-a){E("overflow")}a+=j(i/n);i%=n;t.splice(i++,0,a)}return N(t)}function D(e){var t,r,n,i,a,s,o,u,p,d,v,b=[],w,A,x,O;e=I(e);w=e.length;t=m;r=0;a=y;for(s=0;s<w;++s){v=e[s];if(v<128){b.push(C(v))}}n=i=b.length;if(i){b.push(g)}while(n<w){for(o=f,s=0;s<w;++s){v=e[s];if(v>=t&&v<o){o=v}}A=n+1;if(o-t>j((f-r)/A)){E("overflow")}r+=(o-t)*A;t=o;for(s=0;s<w;++s){v=e[s];if(v<t&&++r>f){E("overflow")}if(v==t){for(u=r,p=h;;p+=h){d=p<=a?l:p>=a+c?c:p-a;if(u<d){break}O=u-d;x=h-d;b.push(C(S(d+O%x,0)));u=j(O/x)}b.push(C(S(u,0)));a=q(r,A,n==i);r=0;++n}}++r;++t}return b.join("")}function L(e){return k(e,function(e){return v.test(e)?U(e.slice(4).toLowerCase()):e})}function z(e){return k(e,function(e){return b.test(e)?"xn--"+D(e):e})}u={version:"1.4.1",ucs2:{decode:I,encode:N},decode:U,encode:D,toASCII:z,toUnicode:L};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return u})}else if(a&&s){if(r.exports==a){s.exports=u}else{for(O in u){u.hasOwnProperty(O)&&(a[O]=u[O])}}}else{i.punycode=u}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,a){t=t||"&";r=r||"=";var s={};if(typeof e!=="string"||e.length===0){return s}var o=/\+/g;e=e.split(t);var u=1e3;if(a&&typeof a.maxKeys==="number"){u=a.maxKeys}var f=e.length;if(u>0&&f>u){f=u}for(var h=0;h<f;++h){var l=e[h].replace(o,"%20"),c=l.indexOf(r),p,d,y,m;if(c>=0){p=l.substr(0,c);d=l.substr(c+1)}else{p=l;d=""}y=decodeURIComponent(p);m=decodeURIComponent(d);if(!n(s,y)){s[y]=m}else if(i(s[y])){s[y].push(m)}else{s[y]=[s[y],m]}}return s};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],6:[function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,o){t=t||"&";r=r||"=";if(e===null){e=undefined}if(typeof e==="object"){return a(s(e),function(s){var o=encodeURIComponent(n(s))+r;if(i(e[s])){return a(e[s],function(e){return o+encodeURIComponent(n(e))}).join(t)}else{return o+encodeURIComponent(n(e[s]))}}).join(t)}if(!o)return"";return encodeURIComponent(n(o))+r+encodeURIComponent(n(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function a(e,t){if(e.map)return e.map(t);var r=[];for(var n=0;n<e.length;n++){r.push(t(e[n],n))}return r}var s=Object.keys||function(e){var t=[];for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t.push(r)}return t}},{}],7:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode");r.encode=r.stringify=e("./encode")},{"./decode":5,"./encode":6}],8:[function(e,t,r){"use strict";var n=e("punycode");var i=e("./util");r.parse=A;r.resolve=j;r.resolveObject=C;r.format=x;r.Url=a;function a(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r","\n","	"],h=["{","}","|","\\","^","`"].concat(f),l=["'"].concat(h),c=["%","/","?",";","#"].concat(l),p=["/","?","#"],d=255,y=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:true,"javascript:":true},v={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},w=e("querystring");function A(e,t,r){if(e&&i.isObject(e)&&e instanceof a)return e;var n=new a;n.parse(e,t,r);return n}a.prototype.parse=function(e,t,r){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var a=e.indexOf("?"),o=a!==-1&&a<e.indexOf("#")?"?":"#",f=e.split(o),h=/\\/g;f[0]=f[0].replace(h,"/");e=f.join(o);var A=e;A=A.trim();if(!r&&e.split("#").length===1){var x=u.exec(A);if(x){this.path=A;this.href=A;this.pathname=x[1];if(x[2]){this.search=x[2];if(t){this.query=w.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var j=s.exec(A);if(j){j=j[0];var C=j.toLowerCase();this.protocol=C;A=A.substr(j.length)}if(r||j||A.match(/^\/\/[^@\/]+@[^@\/]+/)){var O=A.substr(0,2)==="//";if(O&&!(j&&v[j])){A=A.substr(2);this.slashes=true}}if(!v[j]&&(O||j&&!b[j])){var E=-1;for(var P=0;P<p.length;P++){var k=A.indexOf(p[P]);if(k!==-1&&(E===-1||k<E))E=k}var I,N;if(E===-1){N=A.lastIndexOf("@")}else{N=A.lastIndexOf("@",E)}if(N!==-1){I=A.slice(0,N);A=A.slice(N+1);this.auth=decodeURIComponent(I)}E=-1;for(var P=0;P<c.length;P++){var k=A.indexOf(c[P]);if(k!==-1&&(E===-1||k<E))E=k}if(E===-1)E=A.length;this.host=A.slice(0,E);A=A.slice(E);this.parseHost();this.hostname=this.hostname||"";var R=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!R){var S=this.hostname.split(/\./);for(var P=0,q=S.length;P<q;P++){var U=S[P];if(!U)continue;if(!U.match(y)){var D="";for(var L=0,z=U.length;L<z;L++){if(U.charCodeAt(L)>127){D+="x"}else{D+=U[L]}}if(!D.match(y)){var Z=S.slice(0,P);var $=S.slice(P+1);var Q=U.match(m);if(Q){Z.push(Q[1]);$.unshift(Q[2])}if($.length){A="/"+$.join(".")+A}this.hostname=Z.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!R){this.hostname=n.toASCII(this.hostname)}var T=this.port?":"+this.port:"";var _=this.hostname||"";this.host=_+T;this.href+=this.host;if(R){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(A[0]!=="/"){A="/"+A}}}if(!g[C]){for(var P=0,q=l.length;P<q;P++){var M=l[P];if(A.indexOf(M)===-1)continue;var Y=encodeURIComponent(M);if(Y===M){Y=escape(M)}A=A.split(M).join(Y)}}var F=A.indexOf("#");if(F!==-1){this.hash=A.substr(F);A=A.slice(0,F)}var H=A.indexOf("?");if(H!==-1){this.search=A.substr(H);this.query=A.substr(H+1);if(t){this.query=w.parse(this.query)}A=A.slice(0,H)}else if(t){this.search="";this.query={}}if(A)this.pathname=A;if(b[C]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var T=this.pathname||"";var G=this.search||"";this.path=T+G}this.href=this.format();return this};function x(e){if(i.isString(e))e=A(e);if(!(e instanceof a))return a.prototype.format.call(e);return e.format()}a.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",a=false,s="";if(this.host){a=e+this.host}else if(this.hostname){a=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){a+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){s=w.stringify(this.query)}var o=this.search||s&&"?"+s||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&a!==false){a="//"+(a||"");if(r&&r.charAt(0)!=="/")r="/"+r}else if(!a){a=""}if(n&&n.charAt(0)!=="#")n="#"+n;if(o&&o.charAt(0)!=="?")o="?"+o;r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)});o=o.replace("#","%23");return t+a+r+o+n};function j(e,t){return A(e,false,true).resolve(t)}a.prototype.resolve=function(e){return this.resolveObject(A(e,false,true)).format()};function C(e,t){if(!e)return t;return A(e,false,true).resolveObject(t)}a.prototype.resolveObject=function(e){if(i.isString(e)){var t=new a;t.parse(e,false,true);e=t}var r=new a;var n=Object.keys(this);for(var s=0;s<n.length;s++){var o=n[s];r[o]=this[o]}r.hash=e.hash;if(e.href===""){r.href=r.format();return r}if(e.slashes&&!e.protocol){var u=Object.keys(e);for(var f=0;f<u.length;f++){var h=u[f];if(h!=="protocol")r[h]=e[h]}if(b[r.protocol]&&r.hostname&&!r.pathname){r.path=r.pathname="/"}r.href=r.format();return r}if(e.protocol&&e.protocol!==r.protocol){if(!b[e.protocol]){var l=Object.keys(e);for(var c=0;c<l.length;c++){var p=l[c];r[p]=e[p]}r.href=r.format();return r}r.protocol=e.protocol;if(!e.host&&!v[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");r.pathname=d.join("/")}else{r.pathname=e.pathname}r.search=e.search;r.query=e.query;r.host=e.host||"";r.auth=e.auth;r.hostname=e.hostname||e.host;r.port=e.port;if(r.pathname||r.search){var y=r.pathname||"";var m=r.search||"";r.path=y+m}r.slashes=r.slashes||e.slashes;r.href=r.format();return r}var g=r.pathname&&r.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",A=w||g||r.host&&e.pathname,x=A,j=r.pathname&&r.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],C=r.protocol&&!b[r.protocol];if(C){r.hostname="";r.port=null;if(r.host){if(j[0]==="")j[0]=r.host;else j.unshift(r.host)}r.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}A=A&&(d[0]===""||j[0]==="")}if(w){r.host=e.host||e.host===""?e.host:r.host;r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname;r.search=e.search;r.query=e.query;j=d}else if(d.length){if(!j)j=[];j.pop();j=j.concat(d);r.search=e.search;r.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(C){r.hostname=r.host=j.shift();var O=r.host&&r.host.indexOf("@")>0?r.host.split("@"):false;if(O){r.auth=O.shift();r.host=r.hostname=O.shift()}}r.search=e.search;r.query=e.query;if(!i.isNull(r.pathname)||!i.isNull(r.search)){r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")}r.href=r.format();return r}if(!j.length){r.pathname=null;if(r.search){r.path="/"+r.search}else{r.path=null}r.href=r.format();return r}var E=j.slice(-1)[0];var P=(r.host||e.host||j.length>1)&&(E==="."||E==="..")||E==="";var k=0;for(var I=j.length;I>=0;I--){E=j[I];if(E==="."){j.splice(I,1)}else if(E===".."){j.splice(I,1);k++}else if(k){j.splice(I,1);k--}}if(!A&&!x){for(;k--;k){j.unshift("..")}}if(A&&j[0]!==""&&(!j[0]||j[0].charAt(0)!=="/")){j.unshift("")}if(P&&j.join("/").substr(-1)!=="/"){j.push("")}var N=j[0]===""||j[0]&&j[0].charAt(0)==="/";if(C){r.hostname=r.host=N?"":j.length?j.shift():"";var O=r.host&&r.host.indexOf("@")>0?r.host.split("@"):false;if(O){r.auth=O.shift();r.host=r.hostname=O.shift()}}A=A||r.host&&j.length;if(A&&!N){j.unshift("")}if(!j.length){r.pathname=null;r.path=null}else{r.pathname=j.join("/")}if(!i.isNull(r.pathname)||!i.isNull(r.search)){r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")}r.auth=e.auth||r.auth;r.slashes=r.slashes||e.slashes;r.href=r.format();return r};a.prototype.parseHost=function(){var e=this.host;var t=o.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":9,punycode:4,querystring:7}],9:[function(e,t,r){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],10:[function(e,t,r){"use strict";var n={};t.exports=n;n.toCamelCase=function i(e){if(!e||typeof e!=="string"){return""}return e.replace(/^[\s_-]*([^\s_-]+)|[\s_-]+([^\s_-]?)([^\s_-]*)/g,function(e,t,r,n){if(t){return t.toLowerCase()}if(!r){return""}return r.toUpperCase()+n.toLowerCase()})};n.camelCaseToDashed=function a(e){if(!e||typeof e!=="string"){return""}return e.replace(/^([A-Z])|([A-Z])/g,function(e,t,r){if(t){return t.toLowerCase()}return"-"+r.toLowerCase()})}},{}],11:[function(e,t,r){"use strict";var n={};t.exports=n;n.op=function i(e,t,r,n){var i,a,s,o,u,f=false,h=false,l;if(typeof r==="string"){a=r.match(/([.#\[\]]|[^.#\[\]]+)/g)}else if(Array.isArray(r)){a=r;h=true}else{throw new TypeError("[tree.path] ."+e+"(): the path argument should be a string or an array")}switch(e){case"get":case"delete":l=false;break;case"set":case"define":case"inc":case"dec":case"append":case"prepend":case"autoPush":l=true;break;default:throw new TypeError("[tree.path] .op(): wrong type of operation '"+e+"'")}o=t;s=a.length-1;for(i=0;i<=s;i++){if(h){if(u===undefined){u=a[i];continue}if(!o[u]||typeof o[u]!=="object"&&typeof o[u]!=="function"){if(!l){return undefined}o[u]={}}o=o[u];u=a[i];continue}else if(a[i]==="."){f=false;if(u===undefined){continue}if(!o[u]||typeof o[u]!=="object"&&typeof o[u]!=="function"){if(!l){return undefined}o[u]={}}o=o[u];continue}else if(a[i]==="#"||a[i]==="["){f=true;if(u===undefined){if(!Array.isArray(o)){return undefined}continue}if(!o[u]||!Array.isArray(o[u])){if(!l){return undefined}o[u]=[]}o=o[u];continue}else if(a[i]==="]"){continue}if(!f){u=a[i];continue}switch(a[i]){case"length":u=a[i];break;case"first":u=0;break;case"last":u=o.length-1;if(u<0){u=0}break;case"next":if(!l){return undefined}u=o.length;break;case"insert":if(!l){return undefined}o.unshift(undefined);u=0;break;default:u=parseInt(a[i],10)}}switch(e){case"get":return o[u];case"delete":if(f&&typeof u==="number"){o.splice(u,1)}else{delete o[u]}return;case"set":o[u]=n;return o[u];case"define":if(!(u in o)){o[u]=n}return o[u];case"inc":if(typeof o[u]==="number"){o[u]++}else if(!o[u]||typeof o[u]!=="object"){o[u]=1}return o[u];case"dec":if(typeof o[u]==="number"){o[u]--}else if(!o[u]||typeof o[u]!=="object"){o[u]=-1}return o[u];case"append":if(!o[u]){o[u]=[n]}else if(Array.isArray(o[u])){o[u].push(n)}return o[u];case"prepend":if(!o[u]){o[u]=[n]}else if(Array.isArray(o[u])){o[u].unshift(n)}return o[u];case"autoPush":if(o[u]===undefined){o[u]=n}else if(Array.isArray(o[u])){o[u].push(n)}else{o[u]=[o[u],n]}return o[u]}};n.get=n.op.bind(undefined,"get");n.delete=n.op.bind(undefined,"delete");n.set=n.op.bind(undefined,"set");n.define=n.op.bind(undefined,"define");n.inc=n.op.bind(undefined,"inc");n.dec=n.op.bind(undefined,"dec");n.append=n.op.bind(undefined,"append");n.prepend=n.op.bind(undefined,"prepend");n.autoPush=n.op.bind(undefined,"autoPush");n.prototype={get:function(e){return n.get(this,e)},"delete":function(e){return n.delete(this,e)},set:function(e,t){return n.set(this,e,t)},define:function(e,t){return n.define(this,e,t)},inc:function(e,t){return n.inc(this,e,t)},dec:function(e,t){return n.dec(this,e,t)},append:function(e,t){return n.append(this,e,t)},prepend:function(e,t){return n.prepend(this,e,t)},autoPush:function(e,t){return n.autoPush(this,e,t)}};n.upgrade=function a(e){Object.defineProperties(e,{get:{value:n.op.bind(undefined,"get",e)},"delete":{value:n.op.bind(undefined,"delete",e)},set:{value:n.op.bind(undefined,"set",e)},define:{value:n.op.bind(undefined,"define",e)},inc:{value:n.op.bind(undefined,"inc",e)},dec:{value:n.op.bind(undefined,"dec",e)},append:{value:n.op.bind(undefined,"append",e)},prepend:{value:n.op.bind(undefined,"prepend",e)},autoPush:{value:n.op.bind(undefined,"autoPush",e)}})}},{}]},{},[1])(1)});