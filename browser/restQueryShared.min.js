(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.restQueryShared=e()}})(function(){var e,t,r;return function(){function e(t,r,n){function i(s,o){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return i(r||e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,r){"use strict";t.exports={path:e("./path.js")}},{"./path.js":3}],2:[function(e,t,r){"use strict";var n={lowerCaseArray:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],upperCaseArray:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],digitArray:["0","1","2","3","4","5","6","7","8","9"],lowerCaseAndDigitArray:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],collectionRegExp:"^[A-Z][a-zA-Z0-9]*$",methodRegExp:"^[A-Z][A-Z0-9-]*$",propertyRegExp:"^(\\.[a-zA-Z0-9_-]+)+$",linkPropertyRegExp:"^~[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)*$",multiLinkPropertyRegExp:"^~~[a-zA-Z0-9_-]+$",idRegExp:"^[0-9a-f]{24}$",rangeRegExp:"^([0-9]+)(?:-([0-9]+))?$",slugIdRegExp:"^[a-z0-9-]{1,72}$",asciiMapCommon:{"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","ẞ":"ss","œ":"oe","Œ":"OE","“":'"',"”":'"',"‘":"'","’":"'","…":"..."},asciiMapWorldAlpha:{"α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","ş":"s","Ş":"S","ı":"i","İ":"I","ğ":"g","Ğ":"G","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ś":"S","Ź":"Z","Ż":"Z","ā":"a","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ū":"u","Ā":"A","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Ū":"u"},asciiMapSymbolsEn:{"€":" euro","₢":" cruzeiro","₣":" french franc","£":" pound","₤":" lira","₥":" mill","₦":" naira","₧":" peseta","₨":" rupee","₩":" won","₪":" new shequel","₫":" dong","₭":" kip","₮":" tugrik","₯":" drachma","₰":" penny","₱":" peso","₲":" guarani","₳":" austral","₴":" hryvnia","₵":" cedi","¢":" cent","¥":" yen","元":" yuan","円":" yen","﷼":" rial","₠":" ecu","¤":" currency","฿":" baht","\\$":" dollar","©":" (c)","∑":" sum","®":" (r)","†":" +","∂":" d","ƒ":" f","™":" tm","℠":" sm","˚":" o","º":" o","ª":" a","•":" *","∆":" delta","∞":" infinity","♥":" love","&":" and","\\|":" or","<":" less",">":" greater"},asciiMapSymbolsFr:{"€":" euro","₢":" cruzeiro","₣":" franc","£":" livre","₤":" lire","₥":" mill","₦":" naira","₧":" peseta","₨":" rupee","₩":" won","₪":" new shequel","₫":" dong","₭":" kip","₮":" tugrik","₯":" drachma","₰":" penny","₱":" peso","₲":" guarani","₳":" austral","₴":" hryvnia","₵":" cedi","¢":" cent","¥":" yen","元":" yuan","円":" yen","﷼":" rial","₠":" ecu","¤":" monnaie","฿":" baht","\\$":" dollar","©":" (c)","∑":" sum","®":" (r)","†":" +","∂":" d","ƒ":" f","™":" tm","℠":" sm","˚":" o","º":" o","ª":" a","•":" *","∆":" delta","∞":" infini","♥":" aime","&":" et","\\|":" ou","<":" moins",">":" plus"}};t.exports=n},{}],3:[function(e,t,r){"use strict";var n=e("./charmap.js");var i=e("string-kit/lib/camel.js");var a=e("tree-kit/lib/path.js");var s={};t.exports=s;function o(e){return e.value}function u(){return this.value}function f(){return this.match.toString()}function c(...e){if(!e.length){return"/"+this.map(o).join("/")}return"/"+Array.prototype.slice.call(this,...e).map(o).join("/")}function l(...e){return h(Array.prototype.slice.call(this,...e))}function d(){return this[this.length-1]}function p(){var e;e=this.path.toString()+(this.query||"");if(this.hash){e+="#"+this.hash.action;if(this.hash.path){e+=":"+this.hash.path.toString()}}return e}function h(e){e=e||[];Object.defineProperties(e,{toString:{value:c},slice:{value:l},last:{get:d}});return e}function y(e){e=e||{};Object.defineProperties(e,{toString:{value:p}});return e}function g(e){e=e||{};Object.defineProperties(e,{primaryPath:{get:function(){if(this.subPath){return this.subPath.before}return this.full}},hashPrimaryPath:{get:function(){if(!this.hash||!this.hash.path){return null}else if(this.hash.path.subPath){return this.hash.path.subPath.before}return this.hash.path.full}}});return e}s.parse=function e(t,r){var n,i,a,o,u,f,c;if(Array.isArray(t)){return t}else if(typeof t!=="string"){throw new Error("[restQuery] .parse() 'path' should be a string")}u=h();t=t.replace(/\/+/,"/");o=t.split("/");try{for(n=0,a=0,i=o.length;n<i;n++){if(o[n]===""){continue}f=s.parseNode(o[n],r);if(a&&(f.type==="property"||f.type==="linkProperty")&&u[a-1].type==="property"){u[a-1].identifier+="."+f.identifier;u[a-1].type=f.type}else{u[a]=f;a++}}}catch(e){c=new Error("Bad URL: '"+o[n]+"' does not match any node type");c.type="badRequest";throw c}return u};s.parseNode=function e(t,r){var a,s;if(t.length<1){throw new Error("[restQuery] parseNode() : argument #0 length should be >= 1")}if(t.length>72){throw new Error("[restQuery] parseNode() : argument #0 length should be <= 72")}var o={value:t,isDocument:false,isCollection:false};Object.defineProperties(o,{toString:{value:u}});if(r){if(t[0]==="{"&&t[t.length-1]==="}"){s=t.slice(1,-1).split(":");if(s[1]){o.matchName=s[1]}t=s[0];if(t[0]==="$"){o.type="context";o.contextPath=t=t.slice(1);return o}switch(t){case"*":o.type="wildcard";o.wildcard="any";break;case"...":o.type="wildcard";o.wildcard="anySubPath";break;case"id":o.type="wildcard";o.wildcard="anyId";o.isDocument=true;break;case"slugId":o.type="wildcard";o.wildcard="anySlugId";o.isDocument=true;break;case"document":o.type="wildcard";o.wildcard="anyDocument";o.isDocument=true;break;case"collection":o.type="wildcard";o.wildcard="anyCollection";o.isCollection=true;break;default:throw new Error("[restQuery] parseNode() -- bad node special type: "+t)}return o}s=t.split(":");if(s[1]){o.matchName=s[1]}t=s[0]}if(n.upperCaseArray.indexOf(t[0])!==-1){if(t.length===1){o.type="collection";o.identifier=t[0].toLowerCase()+t.slice(1);o.isCollection=true;return o}if(n.lowerCaseArray.indexOf(t[1])!==-1){if(t.match(n.collectionRegExp)){o.type="collection";o.identifier=t[0].toLowerCase()+t.slice(1);o.isCollection=true;return o}throw new Error("[restQuery] parseNode() : argument #0 start with an uppercase and then a lowercase letter but mismatch a collection type")}if(t.match(n.methodRegExp)){o.type="method";o.identifier=i.toCamelCase(t);return o}if(t.match(n.collectionRegExp)){o.type="collection";o.identifier=t[0].toLowerCase()+t.slice(1);o.isCollection=true;return o}throw new Error("[restQuery] parseNode() : argument #0 start with an uppercase but mismatch collection or method type")}if(t.length===24&&t.match(n.idRegExp)){o.type="id";o.identifier=t;o.isDocument=true;return o}if(t[0]==="."){if(!t.match(n.propertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}o.type="property";o.identifier=t.slice(1);o.isDocument=true;return o}if(t[0]==="~"){if(t[1]==="~"){if(!t.match(n.multiLinkPropertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}o.type="multiLinkProperty";o.identifier=t.slice(2);o.isCollection=true;return o}if(!t.match(n.linkPropertyRegExp)){throw new Error("[restQuery] parseNode() : argument #0 does not validate")}o.type="linkProperty";o.identifier=t.slice(1);o.isDocument=true;return o}if(n.digitArray.indexOf(t[0])!==-1&&(a=t.match(n.rangeRegExp))){if(a[2]){o.type="range";o.min=parseInt(a[1],10);o.max=parseInt(a[2],10);o.isCollection=true;return o}o.type="offset";o.identifier=parseInt(t,10);o.isDocument=true;return o}if(n.lowerCaseAndDigitArray.indexOf(t[0])!==-1&&t.match(n.slugIdRegExp)){o.type="slugId";o.identifier=t;o.isDocument=true;return o}throw new Error("[restQuery] parseNode() : argument #0 does not validate")};function m(e){var t,r={};for(t in e){r[t]=e[t]}Object.defineProperties(r,{toString:{value:u}});return r}function b(e,t,r){if(!t[r]){t[r]=1}else if(t[r]===1){e[r+"1"]=e[r];delete e[r];t[r]=2;r+="2"}else{r+=++t[r]}return r}function w(e,t,r,n){n=b(e,r,n);e[n]=t;return t}function A(e,t,r,n,i,a){a=b(e,i,a);var s=Object.create(Object.prototype,{toString:{value:f}});s.match=t.slice(r,n+1);s.before=t.slice(0,r);s.after=t.slice(n+1);s.upto=t.slice(0,n+1);s.onward=t.slice(r);e[a]=s;return s}s.applyContext=function e(t,r){var n,i,o,u=[];if(!Array.isArray(t)){t=s.parse(t,true)}for(n=0,i=t.length;n<i;n++){if(t[n].contextPath){o=a.get(r,t[n].contextPath);if(Array.isArray(o)){u=u.concat(o);continue}if(typeof o!=="string"){if(o&&typeof o==="object"&&o.toString){o=o.toString()}else{return false}}o=s.parse(o);if(!o){return false}u=u.concat(o)}else{u.push(t[n])}}return h(u)};s.match=function e(t,r,n){try{if(!Array.isArray(t)){t=s.parse(t,true)}if(!Array.isArray(r)){r=s.parse(r)}}catch(e){return false}var i,a,o,u=null,f=0,c,l=null,d=g(),p=h(),y={};d.full=r;if(t.length===0){return r.length===0?d:false}if(n){t=s.applyContext(t,n,true);if(!t){return undefined}}for(i=0,a=t.length;i<a;i++){if(t[i].contextPath){throw new Error("[restQuery] .match() this pattern needs a context.")}if(t[i].wildcard==="anySubPath"){f++}}for(i=0,a=r.length;i<a;i++){p[i]=m(r[i])}if(f){if(f>1){console.log("Warning: multiple 'anySubPath' wildcards in the same pattern are not supported ATM");return false}c=r.length-t.length+1;if(c<0){return false}}else if(r.length!==t.length){return false}for(i=0,o=0,a=t.length;i<a;i++,o++){l=null;switch(t[i].wildcard){case"any":u=null;A(d,p,o,o,y,t[i].matchName||"wild");break;case"anySubPath":u=null;A(d,p,o,o+c-1,y,t[i].matchName||"subPath");o+=c-1;break;case"anyId":if(r[o].type!=="id"){return false}l=A(d,p,o,o,y,t[i].matchName||"wildId");break;case"anySlugId":if(r[o].type!=="slugId"){return false}l=A(d,p,o,o,y,t[i].matchName||"wildSlugId");break;case"anyDocument":if(r[o].type!=="id"&&r[o].type!=="slugId"){return false}l=A(d,p,o,o,y,t[i].matchName||"wildDocument");break;case"anyCollection":if(r[o].type!=="collection"){return false}u=t[i].matchName||"wildCollection";l=A(d,p,o,o,y,u);break;default:if(t[i].type!==r[o].type||t[i].identifier!==r[o].identifier){return false}if(t[i].isCollection){u=t[i].matchName||t[i].identifier;A(d,p,o,o,y,u)}}if(t[i].isDocument&&u&&r[o]){if(l){w(d,l,y,u+"Document")}else{A(d,p,o,o,y,u+"Document")}}if(!t[i].isCollection){u=null}}return d};s.fullPathParse=function e(t,r){if(t&&typeof t==="object"){return t}var n,i=y();n=t.match(/^(\/[^#?]*)(?:\?([^#]+))?(?:#([^]+)?)?$/);if(!n){throw new Error("[restQuery] .fullPathParse() 'fullPath' should be a valid path")}i.path=s.parse(n[1],r);if(n[2]!==undefined){i.query=n[2]}if(n[3]!==undefined){i.hash=s.hashParse(n[3],r)}return i};s.hashParse=function e(t,r){var n=t.indexOf(":");if(n===-1){return{action:t}}return{action:t.slice(0,n),path:s.parse(t.slice(n+1),r)}};s.fullPathMatch=function e(t,r,n){var i,a;try{if(!t||typeof t!=="object"){t=s.fullPathParse(t,true)}if(!r||r!=="object"){r=s.fullPathParse(r)}}catch(e){return false}if(t.hash){if(t.hash.action!=="*"&&(!r.hash||t.hash.action!==r.hash.action)){return false}if(!t.hash.path!==!r.hash.path){return false}if(r.hash){a={action:r.hash.action}}if(t.hash.path){if(!r.hash){return false}a.path=s.match(t.hash.path,r.hash.path,n);if(!a){return a}}}i=s.match(t.path,r.path,n);if(!i){return i}if(a){i.hash=a}return i}},{"./charmap.js":2,"string-kit/lib/camel.js":4,"tree-kit/lib/path.js":5}],4:[function(e,t,r){"use strict";var n={};t.exports=n;n.toCamelCase=function e(t,r=false){if(!t||typeof t!=="string"){return""}return t.replace(/^[\s_-]*([^\s_-]+)|[\s_-]+([^\s_-]?)([^\s_-]*)/g,(e,t,n,i)=>{if(r){if(t){return t}if(!n){return""}return n.toUpperCase()+i}if(t){return t.toLowerCase()}if(!n){return""}return n.toUpperCase()+i.toLowerCase()})};n.camelCaseToDash=n.camelCaseToDashed=function e(t){if(!t||typeof t!=="string"){return""}return t.replace(/^([A-Z])|([A-Z])/g,(e,t,r)=>{if(t){return t.toLowerCase()}return"-"+r.toLowerCase()})}},{}],5:[function(e,t,r){"use strict";var n={};t.exports=n;n.op=function e(t,r,n,i){var a,s,o,u,f,c=false,l=false,d,p=true;if(!r||typeof r!=="object"&&typeof r!=="function"){return}if(typeof n==="string"){if(n){s=n.match(/([.#[\]]|[^.#[\]]+)/g)}else{s=[""]}if(s[0]==="."){s.unshift("")}if(s[s.length-1]==="."){s.push("")}}else if(Array.isArray(n)){s=n;l=true}else{throw new TypeError("[tree.path] ."+t+"(): the path argument should be a string or an array")}switch(t){case"get":case"delete":d=false;break;case"set":case"define":case"inc":case"dec":case"append":case"prepend":case"concat":case"insert":case"autoPush":d=true;break;default:throw new TypeError("[tree.path] .op(): wrong type of operation '"+t+"'")}u=r;o=s.length-1;for(a=0;a<=o;a++){if(l){if(f===undefined){f=s[a];continue}if(!u[f]||typeof u[f]!=="object"&&typeof u[f]!=="function"){if(!d){return undefined}u[f]={}}u=u[f];f=s[a];continue}else if(s[a]==="."){c=false;if(f===undefined){if(!p){p=true;continue}f=""}if(!u[f]||typeof u[f]!=="object"&&typeof u[f]!=="function"){if(!d){return undefined}u[f]={}}u=u[f];p=true;continue}else if(s[a]==="#"||s[a]==="["){c=true;p=false;if(f===undefined){if(!Array.isArray(u)){return undefined}continue}if(!u[f]||!Array.isArray(u[f])){if(!d){return undefined}u[f]=[]}u=u[f];continue}else if(s[a]==="]"){p=false;continue}p=false;if(!c){f=s[a];continue}switch(s[a]){case"length":f=s[a];break;case"first":f=0;break;case"last":f=u.length-1;if(f<0){f=0}break;case"next":if(!d){return undefined}f=u.length;break;case"insert":if(!d){return undefined}u.unshift(undefined);f=0;break;default:f=parseInt(s[a],10)}}switch(t){case"get":return u[f];case"delete":if(c&&typeof f==="number"){u.splice(f,1)}else{delete u[f]}return;case"set":u[f]=i;return u[f];case"define":if(!(f in u)){u[f]=i}return u[f];case"inc":if(typeof u[f]==="number"){u[f]++}else if(!u[f]||typeof u[f]!=="object"){u[f]=1}return u[f];case"dec":if(typeof u[f]==="number"){u[f]--}else if(!u[f]||typeof u[f]!=="object"){u[f]=-1}return u[f];case"append":if(!u[f]){u[f]=[i]}else if(Array.isArray(u[f])){u[f].push(i)}return u[f];case"prepend":if(!u[f]){u[f]=[i]}else if(Array.isArray(u[f])){u[f].unshift(i)}return u[f];case"concat":if(!u[f]){u[f]=i}else if(Array.isArray(u[f])&&Array.isArray(i)){u[f]=u[f].concat(i)}return u[f];case"insert":if(!u[f]){u[f]=i}else if(Array.isArray(u[f])&&Array.isArray(i)){u[f]=i.concat(u[f])}return u[f];case"autoPush":if(u[f]===undefined){u[f]=i}else if(Array.isArray(u[f])){u[f].push(i)}else{u[f]=[u[f],i]}return u[f]}};n.get=n.op.bind(undefined,"get");n.delete=n.op.bind(undefined,"delete");n.set=n.op.bind(undefined,"set");n.define=n.op.bind(undefined,"define");n.inc=n.op.bind(undefined,"inc");n.dec=n.op.bind(undefined,"dec");n.append=n.op.bind(undefined,"append");n.prepend=n.op.bind(undefined,"prepend");n.concat=n.op.bind(undefined,"concat");n.insert=n.op.bind(undefined,"insert");n.autoPush=n.op.bind(undefined,"autoPush");n.prototype={get:function(e){return n.get(this,e)},delete:function(e){return n.delete(this,e)},set:function(e,t){return n.set(this,e,t)},define:function(e,t){return n.define(this,e,t)},inc:function(e,t){return n.inc(this,e,t)},dec:function(e,t){return n.dec(this,e,t)},append:function(e,t){return n.append(this,e,t)},prepend:function(e,t){return n.prepend(this,e,t)},concat:function(e,t){return n.concat(this,e,t)},insert:function(e,t){return n.insert(this,e,t)},autoPush:function(e,t){return n.autoPush(this,e,t)}};n.upgrade=function e(t){Object.defineProperties(t,{get:{value:n.op.bind(undefined,"get",t)},delete:{value:n.op.bind(undefined,"delete",t)},set:{value:n.op.bind(undefined,"set",t)},define:{value:n.op.bind(undefined,"define",t)},inc:{value:n.op.bind(undefined,"inc",t)},dec:{value:n.op.bind(undefined,"dec",t)},append:{value:n.op.bind(undefined,"append",t)},prepend:{value:n.op.bind(undefined,"prepend",t)},concat:{value:n.op.bind(undefined,"concat",t)},insert:{value:n.op.bind(undefined,"insert",t)},autoPush:{value:n.op.bind(undefined,"autoPush",t)}})}},{}]},{},[1])(1)});